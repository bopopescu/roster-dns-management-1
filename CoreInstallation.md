#summary Installation of Roster Core
## Roster Core Setup ##

> From pypi:
```
# easy_install RosterCore
```

> From source package:
```
# python setup.py install
```

**Note about installation path:**
The scripts used on this page are default installed by setuptools to **_prefix_/bin**
prefix is default **/usr**. However, this might be different depending on the system.
If you'd like to find out what **_prefix_** is for your system, open up a python shell and type:
```
  Python 2.6.6 (r266:84292, Sep 12 2011, 14:03:14) 
  [GCC 4.4.5 20110214 (Red Hat 4.4.5-6)] on linux2
  Type "help", "copyright", "credits" or "license" for more information.
  >>> import sys
  >>> sys.exec_prefix
  '/usr'
```
If you'd like to know more, please consult: [Installing Python Modules](http://docs.python.org/install/index.html#inst-alt-install,).
From this point forward, it is expected that the scripts are installed in a directory in your $PATH.

## Bootstrapping the Database ##

A database needs to be set up initially for Roster to use. The script "roster\_database\_bootstrap" can be used to set up the new database, generate the rosterd init script, and create a roster config file. (This script is also located in the roster-core/scripts directory of the install) If a previously generated config file is found, it can be used when prompted to avoid information re-entry.
**Note:** bootstrapping a database will wipe all previous information stored in the database.

### Using a Config File ###

Example Usage:
```
# roster_database_bootstrap -U <new_roster_user> --force
Config file /etc/roster/roster_server.conf exists, use it? (Y/n): y
```


### Not Using a Config File ###

> Example Usage:
```
# roster_database_bootstrap -d <database_name> -n <database_server>
-u <database_user> -U <new_roster_user> --ssl-key <key_file>
--ssl-cert <cert_file> -c <config_output_file> 
```

SSL keys must be generated and placed in the directories from the configuration file generated by roster\_database\_bootstrap. You can use [openssl](http://www.tc.umn.edu/~brams006/selfsign.html) to generate these keys.

Follow the onscreen prompts and select an authentication method. The authentication module will request some information about authentication that needs to be entered at this time.
> Example:
```
Enter database password for <database_name>: 
1. general_ldap
Select an authentication module (1 - 1) above: 1
Enter 'binddn' for 'general_ldap': uid=%%s,ou=People,dc=dc,dc=university,dc=edu
Enter 'cert_file' for 'general_ldap' (Enter for None):  
Enter 'version' for 'general_ldap': VERSION3
Enter 'server' for 'general_ldap': ldaps://university.edu/
```

### Configuration ###
Finally, manually open the config file (Default location: **/etc/roster/roster\_server.conf**) and examine its contents.

**Note:** some operating systems (such as Ubuntu) do not allow PAM requests from the user nobody. There are [many solutions](http://publib.boulder.ibm.com/infocenter/tivihelp/v8r1/index.jsp?topic=%2Fcom.ibm.netcool_OMNIbus.doc_7.3.0%2Fomnibus%2Fwip%2Fcommon%2Freference%2Fomn_trb_userauthfailurepam.html) to allowing non-root users to authenticate other users.

Once you have verified the config file correct, and you are finished, change the **`'server_killswitch'`** value in the **`[server]`** section to **`'off'`** and **`chmod`** the config file to non-world-writable. This will allow the [Roster Server](ServerInstallation.md) to start.

For a detailed outline of the Roster Server config file, see the [Roster Server Config File](RosterServerConfigFile.md) page.

### More on bootstrapping ###

Additional options can be configured using special flags visible with **`roster_database_bootstrap --help`**
```
Options:
  --version             show programs version number and exit
  -h, --help            show this help message and exit
  -c <config-file>, --config-file=<config-file>
                        Location of the new config file.
  -i <init-file>, --init-file=<init-file>
                        Location of the init file, default is reccommended.
  -u <user-name>, --user-name=<user-name>
                        MySQL username.
  -U ROSTER_USER_NAME, --roster-user-name=ROSTER_USER_NAME
                        Initial admin username for roster.
  --run-as-username=RUN_AS_USERNAME
                        Username roster server should run as.
  --infinite-renew-time=<time>
                        Time in seconds to renew infinite credentials.
  --core-die-time=<time>
                        Time in seconds that a core instance will die.
  --get-credentials-wait-increment=<int>
                        Seconds to add wait with incorrect password.
  --credential-expiry-time=<time>
                        Time in seconds for credentials to expire.
  -d <database>, --database=<database>
                        MySQL database name.
  -n <hostname>, --hostname=<hostname>
                        MySQL database hostname.
  --big-lock-timeout=<seconds>
                        Timeout for big database lock.
  --big-lock-wait=<seconds>
                        Wait for big database lock.
  --force               Force overwriting a database.
  --ssl-cert=SSL_CERT   SSL Cert file for XML-RPC.
  --ssl-key=SSL_KEY     SSL Key file for XML-RPC.
  --db-ssl              Enable SSL for database.
  --db-ssl-ca=DB_SSL_CA
                        SSL Certificate Authority file for database.
  --server-log-file=SERVER_LOG_FILE
                        Server log file location
  --backup-dir=BACKUP_DIR
                        Directory where backups will be put.
  --root-config-dir=ROOT_CONFIG_DIR
                        Directory where bind config files will be dumped.
  --run-as=RUN_AS       Run as uid
  -p <password>, --db-password=<password>
                        Password for the database user. Do not use this flag
                        unless you need to. If not used a password prompt will
                        be presented.
  --server-port=PORT    Port server will start with.
  --server-host=HOST    Host server will start with.
  --db_debug=DB_DEBUG   Print MySQL commands to stdout or a file
  --db_debug_log=DB_DEBUG_LOG
                        Log file to send MySQL commands to, if blank, stdout
                        is used.
  --smtp-server=SMTP_SERVER
                        SMTP server for dnsexportconfig to send error messages
                        through.
  --system-email=SYSTEM_EMAIL
                        The email address to send error messages from.
  --failure-email=FAILURE_EMAIL
                        The email address to send error messages to.
  --failure-email-subject=FAILURE_SUBJECT
                        The subject line of error messages.
  --exporter-debug      Print debug statements during Roster exporting.
  --root-hint-file=ROOT_HINT_FILE
                        Location of root hint file.
  --max-threads=MAX_THREADS
                        Maximum number of threads to run in parallel during
                        dnsexportconfig execution.
  --zone-default-refresh-seconds=REFRESH_SECONDS
                        Refresh seconds to use during zone bootstrapping.
  --zone-default-expiry-seconds=EXPIRY_SECONDS
                        Expiry seconds to use during zone bootstrapping.
  --zone-default-minimum-seconds=MINIMUM_SECONDS
                        Minimum seconds to use during zone bootstrapping.
  --zone-default-retry-seconds=RETRY_SECONDS
                        Retry seconds to use during zone bootstrapping.
  --zone-default-nameserver-ttl=NS_TTL
                        Nameserver TTL to use during zone bootstrapping.
  --zone-default-soa-ttl=SOA_TTL
                        SOA TTL to use during zone bootstrapping.
```
### Config File ###
The Roster config file generated is used to store information you do not want to supply on the command line.

This is an example roster config file from **`/test/test_data/roster_example.conf`**:
```
##### MOVE THIS FILE TO roster.conf TO GET THE UNITTESTS TO PICK IT UP #####

##### DATABASE CONFIG #####
[database]
# Database server address
server = database.university.edu
# Database username
login = roster_test
# Database password
passwd = test
# Database name
database = roster_test
# big lock timeout
big_lock_timeout = 90
# big lock wait
big_lock_wait = 5
# Enable ssl in database connection
ssl = off
# Database ssl ca
ssl_ca = /etc/mysql/server-ca.pem
db_debug = off
db_debug_log = 


##### SERVER CONFIG #####
[server]
# Port to start server with
port = 8000
# Host to start server with
host = localhost
# Time to renew infinite credentials in seconds
inf_renew_time = 432000
# Time for a core instance to die
core_die_time = 1200
# Seconds to add wait for incorrect password
get_credentials_wait_increment = 1
# Change server_killswitch to off to allow server to run 
server_killswitch = off
# Ssl keyfile
ssl_key_file = /etc/roster_certs/host.key
# Ssl certfile
ssl_cert_file = /etc/roster_certs/host.cert
# Lock file
lock_file = /var/lock/roster
# Run as username
run_as_username = nobody
# Server logfile
server_log_file = /var/log/rosterd


#Defaults for zone bootstraping
[zone_defaults]
refresh_seconds = 3600
expiry_seconds = 1814400
minimum_seconds = 86400
retry_seconds = 600
ns_ttl = 3600
soa_ttl = 3600


##### CREDENTIAL CONFIG #####
[credentials]
# Credential expiry time in seconds
exp_time = 3600
# Authentication method
authentication_method = auth_pam


##### EXPORTER CONFIG #####
[exporter]
root_config_dir = root_config_dir
backup_dir = test_data/backup_dir
exporter_debug = on
smtp_server = localhost
failure_notification_email = admin@localhost
system_email = admin@localhost
email_subject = [Roster] dnsexportconfig Failure
root_hint_file = test_data/named.ca
max_threads = 10


##### AUTH_PAM CONFIG #####
[auth_pam]
```